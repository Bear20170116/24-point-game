<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>24ç‚¹é€šå…³æ¸¸æˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <meta name="description" content="ç»å…¸24ç‚¹æ¸¸æˆï¼Œç”¨4ä¸ªæ•°å­—é€šè¿‡åŠ å‡ä¹˜é™¤è¿ç®—å¾—åˆ°24">
    <meta name="theme-color" content="#3b82f6">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="icons/icon-512x512.png" type="image/png">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .number-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .number-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb, #1d4ed8);
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #6b7280, #4b5563);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #4b5563, #374151);
            transform: translateY(-1px);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            transition: all 0.3s ease;
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-1px);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            transition: all 0.3s ease;
        }
        
        .btn-warning:hover {
            background: linear-gradient(135deg, #d97706, #b45309);
            transform: translateY(-1px);
        }
        
        .input-answer {
            border: 2px solid #e5e7eb;
            transition: all 0.3s ease;
        }
        
        .input-answer:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .celebration {
            animation: celebration 0.6s ease-in-out;
        }
        
        @keyframes celebration {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background-color: #f00;
            border-radius: 50%;
            animation: confetti-fall 3s ease-in-out forwards;
            z-index: 9999;
        }
        
        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-400 to-purple-500 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-md">
        <!-- æ¸¸æˆæ ‡é¢˜ -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2 drop-shadow-lg">24ç‚¹é€šå…³æ¸¸æˆ</h1>
            <p class="text-white text-opacity-90 text-lg">ç”¨4ä¸ªæ•°å­—ï¼Œé€šè¿‡åŠ å‡ä¹˜é™¤è¿ç®—å¾—åˆ°24</p>
        </div>

        <!-- æ¸¸æˆåŒºåŸŸ -->
        <div class="bg-white bg-opacity-10 backdrop-blur-lg rounded-2xl p-6 shadow-2xl border border-white border-opacity-20">
            <!-- æ•°å­—å¡ç‰‡åŒºåŸŸ -->
            <div class="grid grid-cols-2 gap-4 mb-6">
                <div id="number1" class="number-card w-full h-24 rounded-xl flex items-center justify-center text-4xl font-bold text-gray-800">?</div>
                <div id="number2" class="number-card w-full h-24 rounded-xl flex items-center justify-center text-4xl font-bold text-gray-800">?</div>
                <div id="number3" class="number-card w-full h-24 rounded-xl flex items-center justify-center text-4xl font-bold text-gray-800">?</div>
                <div id="number4" class="number-card w-full h-24 rounded-xl flex items-center justify-center text-4xl font-bold text-gray-800">?</div>
            </div>

            <!-- è¾“å…¥åŒºåŸŸ -->
            <div class="mb-6">
                <label for="answer" class="block text-white text-lg font-medium mb-2">è¾“å…¥ä½ çš„è§£æ³•:</label>
                <div class="flex gap-2">
                    <input type="text" id="answer" class="input-answer flex-1 px-4 py-3 rounded-lg text-gray-800 font-medium" placeholder="ä¾‹å¦‚: (1+2)*(3+5)" autocomplete="off">
                    <button id="checkBtn" class="btn-primary px-6 py-3 rounded-lg text-white font-semibold flex items-center">
                        <i class="fa fa-check mr-2"></i>æ£€æŸ¥
                    </button>
                </div>
            </div>

            <!-- æ“ä½œæŒ‰é’® -->
            <div class="flex gap-3 mb-6">
                <button id="hintBtn" class="btn-warning flex-1 px-4 py-3 rounded-lg text-white font-semibold flex items-center justify-center">
                    <i class="fa fa-lightbulb-o mr-2"></i>è·å–æç¤º
                </button>
                <button id="skipBtn" class="btn-secondary flex-1 px-4 py-3 rounded-lg text-white font-semibold flex items-center justify-center">
                    <i class="fa fa-forward mr-2"></i>è·³è¿‡å½“å‰
                </button>
            </div>

            <!-- æ¸¸æˆç»Ÿè®¡ -->
            <div class="bg-white bg-opacity-20 rounded-xl p-4 mb-6">
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div>
                        <div class="text-white text-opacity-80 text-sm">å½“å‰å…³å¡</div>
                        <div id="currentLevel" class="text-white text-2xl font-bold">1</div>
                    </div>
                    <div>
                        <div class="text-white text-opacity-80 text-sm">æ€»å¾—åˆ†</div>
                        <div id="totalScore" class="text-white text-2xl font-bold">0</div>
                    </div>
                    <div>
                        <div class="text-white text-opacity-80 text-sm">æ­£ç¡®ç‡</div>
                        <div id="accuracy" class="text-white text-2xl font-bold">0%</div>
                    </div>
                </div>
            </div>

            <!-- æç¤ºä¿¡æ¯ -->
            <div id="message" class="text-center text-white text-lg font-medium min-h-8 mb-4"></div>

            <!-- å†å²è®°å½• -->
            <div class="bg-white bg-opacity-10 rounded-xl p-4">
                <h3 class="text-white text-lg font-semibold mb-3">æœ€è¿‘é¢˜ç›®</h3>
                <div id="history" class="space-y-2 max-h-32 overflow-y-auto">
                    <!-- å†å²è®°å½•å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>

        <!-- æ¸¸æˆè¯´æ˜ -->
        <div class="mt-8 text-center text-white text-opacity-80 text-sm">
            <p>æ¸¸æˆè§„åˆ™ï¼šä½¿ç”¨åŠ å‡ä¹˜é™¤å’Œæ‹¬å·ï¼Œè®©4ä¸ªæ•°å­—è¿ç®—ç»“æœç­‰äº24</p>
            <p class="mt-2">æ”¯æŒçš„è¿ç®—ç¬¦ï¼š+ - * / ( )</p>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            currentNumbers: [],
            currentLevel: 1,
            totalScore: 0,
            correctCount: 0,
            totalAttempts: 0,
            gameHistory: [],
            hintsUsed: 0,
            skipsUsed: 0
        };

        // æ•°å­—æ± ï¼ˆä¸åŒéš¾åº¦çš„æ•°å­—ç»„åˆï¼‰
        const numberPools = {
            easy: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10],
            medium: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12],
            hard: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20]
        };

        // é¢„å®šä¹‰çš„24ç‚¹é¢˜ç›®ï¼ˆç¡®ä¿æœ‰è§£ï¼‰
        const predefinedProblems = [
            [3, 3, 7, 7],   // (3+3/7)*7=24
            [1, 5, 5, 5],   // (5-1/5)*5=24
            [2, 2, 11, 11], // (2+2/11)*11=24
            [1, 3, 4, 6],   // 6/(1-3/4)=24
            [1, 4, 5, 6],   // 4/(1-5/6)=24
            [3, 3, 8, 8],   // 8/(3-8/3)=24
            [2, 4, 10, 10], // (2+4/10)*10=24
            [1, 2, 3, 4],   // (1+2+3)*4=24
            [2, 3, 4, 5],   // (5+3-2)*4=24
            [3, 4, 5, 6]    // (3+5-4)*6=24
        ];

        // DOMå…ƒç´ 
        const elements = {
            numbers: [
                document.getElementById('number1'),
                document.getElementById('number2'),
                document.getElementById('number3'),
                document.getElementById('number4')
            ],
            answerInput: document.getElementById('answer'),
            checkBtn: document.getElementById('checkBtn'),
            hintBtn: document.getElementById('hintBtn'),
            skipBtn: document.getElementById('skipBtn'),
            message: document.getElementById('message'),
            currentLevel: document.getElementById('currentLevel'),
            totalScore: document.getElementById('totalScore'),
            accuracy: document.getElementById('accuracy'),
            history: document.getElementById('history')
        };

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            console.log('æ¸¸æˆåˆå§‹åŒ–å¼€å§‹...');
            try {
                loadGameState();
                console.log('æ¸¸æˆçŠ¶æ€åŠ è½½å®Œæˆ');
                
                // ç«‹å³ç”Ÿæˆé¢˜ç›®
                generateNewProblem();
                console.log('é¢˜ç›®ç”Ÿæˆå®Œæˆ');
                
                updateDisplay();
                console.log('æ˜¾ç¤ºæ›´æ–°å®Œæˆ');
                
                bindEvents();
                console.log('äº‹ä»¶ç»‘å®šå®Œæˆ');
                
                console.log('æ¸¸æˆåˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
                console.error('æ¸¸æˆåˆå§‹åŒ–å¤±è´¥:', error);
                showMessage('æ¸¸æˆåˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
            }
        }

        // ç”Ÿæˆæ–°é¢˜ç›®
        function generateNewProblem() {
            let numbers;
            
            // å‰10å…³ä½¿ç”¨é¢„å®šä¹‰é¢˜ç›®ï¼Œä¹‹åéšæœºç”Ÿæˆ
            if (gameState.currentLevel <= predefinedProblems.length) {
                numbers = predefinedProblems[gameState.currentLevel - 1];
            } else {
                numbers = generateRandomNumbers();
                // ç¡®ä¿é¢˜ç›®æœ‰è§£ï¼ˆç®€å•éªŒè¯ï¼‰
                while (!hasValidSolution(numbers)) {
                    numbers = generateRandomNumbers();
                }
            }
            
            gameState.currentNumbers = numbers.sort(() => Math.random() - 0.5);
            updateNumberDisplay();
            addToHistory(gameState.currentNumbers);
        }

        // æ ¹æ®éš¾åº¦ç”Ÿæˆéšæœºæ•°å­—
        function generateRandomNumbers() {
            let pool;
            if (gameState.currentLevel <= 10) {
                pool = numberPools.easy;
            } else if (gameState.currentLevel <= 20) {
                pool = numberPools.medium;
            } else {
                pool = numberPools.hard;
            }
            
            const numbers = [];
            for (let i = 0; i < 4; i++) {
                numbers.push(pool[Math.floor(Math.random() * pool.length)]);
            }
            return numbers;
        }

        // ç®€å•éªŒè¯æ˜¯å¦æœ‰è§£ï¼ˆåŸºäºä¸€äº›å¸¸è§æ¨¡å¼ï¼‰
        function hasValidSolution(numbers) {
            // æ£€æŸ¥æ˜¯å¦åŒ…å«å¸¸è§çš„24ç‚¹ç»„åˆ
            const sorted = [...numbers].sort((a, b) => a - b);
            
            // æ£€æŸ¥é¢„å®šä¹‰çš„æœ‰è§£ç»„åˆ
            for (const problem of predefinedProblems) {
                const sortedProblem = [...problem].sort((a, b) => a - b);
                if (arraysEqual(sorted, sortedProblem)) {
                    return true;
                }
            }
            
            // åŸºæœ¬çš„æ•°å­¦éªŒè¯
            return true; // ç®€åŒ–ç‰ˆæœ¬ï¼Œå®é™…åº”è¯¥æœ‰æ›´å¤æ‚çš„éªŒè¯
        }

        // æ•°ç»„æ¯”è¾ƒ
        function arraysEqual(a, b) {
            if (a.length !== b.length) return false;
            for (let i = 0; i < a.length; i++) {
                if (a[i] !== b[i]) return false;
            }
            return true;
        }

        // æ›´æ–°æ•°å­—æ˜¾ç¤º
        function updateNumberDisplay() {
            gameState.currentNumbers.forEach((num, index) => {
                elements.numbers[index].textContent = num;
                elements.numbers[index].classList.add('fade-in');
                setTimeout(() => {
                    elements.numbers[index].classList.remove('fade-in');
                }, 500);
            });
        }

        // æ£€æŸ¥ç­”æ¡ˆ
        function checkAnswer() {
            const userAnswer = elements.answerInput.value.trim();
            if (!userAnswer) {
                showMessage('è¯·è¾“å…¥ä½ çš„è§£æ³•', 'warning');
                return;
            }

            gameState.totalAttempts++;
            
            if (isCorrectAnswer(userAnswer)) {
                handleCorrectAnswer();
            } else {
                handleIncorrectAnswer();
            }
            
            elements.answerInput.value = '';
        }

        // éªŒè¯ç­”æ¡ˆæ˜¯å¦æ­£ç¡®
        function isCorrectAnswer(answer) {
            try {
                // æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æ‰€æœ‰æ•°å­—
                const usedNumbers = extractNumbers(answer);
                if (!containsSameNumbers(usedNumbers, gameState.currentNumbers)) {
                    return false;
                }

                // å®‰å…¨è®¡ç®—è¡¨è¾¾å¼ç»“æœ
                const result = evaluateExpression(answer);
                return Math.abs(result - 24) < 0.001;
            } catch (error) {
                return false;
            }
        }

        // ä»è¡¨è¾¾å¼ä¸­æå–æ•°å­—
        function extractNumbers(expression) {
            return expression.match(/\d+/g).map(Number).sort((a, b) => a - b);
        }

        // æ£€æŸ¥ä¸¤ä¸ªæ•°ç»„æ˜¯å¦åŒ…å«ç›¸åŒæ•°å­—
        function containsSameNumbers(arr1, arr2) {
            if (arr1.length !== arr2.length) return false;
            const sorted1 = [...arr1].sort((a, b) => a - b);
            const sorted2 = [...arr2].sort((a, b) => a - b);
            return arraysEqual(sorted1, sorted2);
        }

        // å®‰å…¨è®¡ç®—è¡¨è¾¾å¼
        function evaluateExpression(expr) {
            // ç§»é™¤æ‰€æœ‰ç©ºæ ¼
            expr = expr.replace(/\s/g, '');
            
            // éªŒè¯è¡¨è¾¾å¼åªåŒ…å«å…è®¸çš„å­—ç¬¦
            if (!/^[\d+\-*/().]+$/.test(expr)) {
                throw new Error('Invalid characters');
            }
            
            // æ£€æŸ¥æ‹¬å·åŒ¹é…
            let bracketCount = 0;
            for (let char of expr) {
                if (char === '(') bracketCount++;
                if (char === ')') bracketCount--;
                if (bracketCount < 0) throw new Error('Mismatched brackets');
            }
            if (bracketCount !== 0) throw new Error('Mismatched brackets');
            
            // ä½¿ç”¨Functionæ„é€ å™¨å®‰å…¨è®¡ç®—
            return Function('"use strict"; return (' + expr + ')')();
        }

        // å¤„ç†æ­£ç¡®ç­”æ¡ˆ
        function handleCorrectAnswer() {
            const baseScore = 100;
            const levelBonus = gameState.currentLevel * 10;
            const timeBonus = Math.max(0, 50 - Math.floor(Math.random() * 30)); // æ¨¡æ‹Ÿæ—¶é—´å¥–åŠ±
            const score = baseScore + levelBonus + timeBonus;
            
            gameState.correctCount++;
            gameState.totalScore += score;
            
            showMessage(`ğŸ‰ æ­å–œï¼å¾—åˆ†ï¼š${score}`, 'success');
            showCelebration();
            
            // æ›´æ–°ç»Ÿè®¡
            updateDisplay();
            
            // å»¶è¿Ÿç”Ÿæˆæ–°é¢˜ç›®
            setTimeout(() => {
                gameState.currentLevel++;
                generateNewProblem();
            }, 2000);
        }

        // å¤„ç†é”™è¯¯ç­”æ¡ˆ
        function handleIncorrectAnswer() {
            showMessage('âŒ ç­”æ¡ˆä¸æ­£ç¡®ï¼Œè¯·å†è¯•ä¸€æ¬¡', 'error');
            shakeNumbers();
        }

        // æ˜¾ç¤ºåº†ç¥åŠ¨ç”»
        function showCelebration() {
            createConfetti();
            elements.numbers.forEach(el => {
                el.classList.add('celebration');
                setTimeout(() => el.classList.remove('celebration'), 600);
            });
        }

        // åˆ›å»ºäº”å½©çº¸å±‘æ•ˆæœ
        function createConfetti() {
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = getRandomColor();
                confetti.style.animationDelay = Math.random() * 3 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                    confetti.remove();
                }, 5000);
            }
        }

        // è·å–éšæœºé¢œè‰²
        function getRandomColor() {
            const colors = ['#f00', '#0f0', '#00f', '#ff0', '#f0f', '#0ff'];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        // æ•°å­—å¡ç‰‡éœ‡åŠ¨æ•ˆæœ
        function shakeNumbers() {
            elements.numbers.forEach(el => {
                el.classList.add('shake');
                setTimeout(() => el.classList.remove('shake'), 500);
            });
        }

        // è·å–æç¤º
        function getHint() {
            const hints = [
                'å°è¯•ä¸åŒçš„è¿ç®—ç¬¦ç»„åˆ',
                'è®°å¾—ä½¿ç”¨æ‹¬å·æ”¹å˜è¿ç®—é¡ºåº',
                'å…ˆè®¡ç®—ä¸¤ä¸ªæ•°å­—ï¼Œå†å’Œå…¶ä»–æ•°å­—ç»„åˆ',
                'å¸¸è§æ¨¡å¼ï¼š3Ã—8=24, 4Ã—6=24, 12Ã—2=24',
                'è€ƒè™‘åˆ†æ•°è¿ç®—ï¼Œæ¯”å¦‚ 3/(1/8)=24'
            ];
            
            const randomHint = hints[Math.floor(Math.random() * hints.length)];
            showMessage(`ğŸ’¡ æç¤ºï¼š${randomHint}`, 'info');
            
            gameState.hintsUsed++;
            gameState.totalScore = Math.max(0, gameState.totalScore - 10); // æç¤ºæ‰£åˆ†
            updateDisplay();
        }

        // è·³è¿‡å½“å‰é¢˜ç›®
        function skipProblem() {
            showMessage('â­ï¸ å·²è·³è¿‡å½“å‰é¢˜ç›®', 'info');
            gameState.skipsUsed++;
            gameState.currentLevel++;
            generateNewProblem();
            updateDisplay();
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(text, type = 'info') {
            elements.message.textContent = text;
            elements.message.className = `text-center font-medium min-h-8 mb-4 fade-in ${getTextClass(type)}`;
            
            setTimeout(() => {
                elements.message.classList.remove('fade-in');
            }, 500);
        }

        // è·å–æ–‡æœ¬æ ·å¼ç±»
        function getTextClass(type) {
            const classes = {
                success: 'text-green-300',
                error: 'text-red-300',
                warning: 'text-yellow-300',
                info: 'text-blue-300'
            };
            return classes[type] || classes.info;
        }

        // æ·»åŠ åˆ°å†å²è®°å½•
        function addToHistory(numbers) {
            const historyItem = document.createElement('div');
            historyItem.className = 'text-white text-opacity-90 text-sm p-2 bg-white bg-opacity-10 rounded-lg';
            historyItem.textContent = numbers.join(', ');
            
            elements.history.insertBefore(historyItem, elements.history.firstChild);
            
            // é™åˆ¶å†å²è®°å½•æ•°é‡
            if (elements.history.children.length > 5) {
                elements.history.removeChild(elements.history.lastChild);
            }
        }

        // æ›´æ–°æ˜¾ç¤º
        function updateDisplay() {
            elements.currentLevel.textContent = gameState.currentLevel;
            elements.totalScore.textContent = gameState.totalScore;
            
            const accuracyRate = gameState.totalAttempts > 0 
                ? Math.round((gameState.correctCount / gameState.totalAttempts) * 100) 
                : 0;
            elements.accuracy.textContent = accuracyRate + '%';
        }

        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            elements.checkBtn.addEventListener('click', checkAnswer);
            elements.hintBtn.addEventListener('click', getHint);
            elements.skipBtn.addEventListener('click', skipProblem);
            
            elements.answerInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    checkAnswer();
                }
            });

            // ç‚¹å‡»æ•°å­—å¡ç‰‡å¯ä»¥è¾“å…¥åˆ°ç­”æ¡ˆæ¡†
            elements.numbers.forEach((el, index) => {
                el.addEventListener('click', () => {
                    elements.answerInput.value += gameState.currentNumbers[index];
                    elements.answerInput.focus();
                });
            });
        }

        // ä¿å­˜æ¸¸æˆçŠ¶æ€
        function saveGameState() {
            localStorage.setItem('24GameState', JSON.stringify(gameState));
        }

        // åŠ è½½æ¸¸æˆçŠ¶æ€
        function loadGameState() {
            const saved = localStorage.getItem('24GameState');
            if (saved) {
                const savedState = JSON.parse(saved);
                Object.assign(gameState, savedState);
            }
        }

        // è‡ªåŠ¨ä¿å­˜æ¸¸æˆçŠ¶æ€
        setInterval(saveGameState, 5000);

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey || e.metaKey) return;
            
            switch(e.key) {
                case 'Enter':
                    checkAnswer();
                    break;
                case 'h':
                case 'H':
                    getHint();
                    break;
                case 's':
                case 'S':
                    skipProblem();
                    break;
            }
        });

        // PWAå®‰è£…æç¤º
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            // å¯ä»¥åœ¨è¿™é‡Œæ˜¾ç¤ºå®‰è£…æç¤º
        });

        // åˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOMåŠ è½½å®Œæˆï¼Œå‡†å¤‡åˆå§‹åŒ–æ¸¸æˆ');
            initGame();
        });

        // æ³¨å†ŒService Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>
